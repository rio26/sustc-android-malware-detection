#!/usr/bin/python3
import json
import os
import numpy as np
import matplotlib.pyplot as plt
json_num=0
spreadList=[]
spreadList2=[]
def get_account(jsonPath,jsonName):
	with open(jsonPath,'r') as j:
		jsonObj = json.load(j)
		per_num=len(jsonObj['permissions'])
	return per_num

def traverse(path,kind):
	global json_num
	jsons = os.listdir(path)
	for json in jsons:
		jsonPath=os.path.join(path,json)
		if (json[-4:]=='json'):
			jsonName=json[0:-5]
			try:
				json_num+=1
				per_num=get_account(jsonPath,jsonName)
				print(per_num,end=' ',file=count)
				if kind == 1 :
					spreadList.append(per_num)
				if kind == 2 :
					spreadList2.append(per_num)
			except Exception as e:
				print("!!fail to get"+jsonName,file=count)
				# get_permissions(apkPath,apkName)
	

count=open('Permission_count_to_do_T_test.txt','w')
path="/home/dell/AndroidMalwareAnalysis/amd" #the location of jsons analysing malware apks
for family in os.listdir(path):
	tmpFamilyPath = os.path.join('/home/dell/AndroidMalwareAnalysis/amd',family)
	if (not os.path.isdir(tmpFamilyPath)):
		continue
	manifests=os.listdir(tmpFamilyPath)
	print(family)
	for manifest in manifests:
		if (manifest[0:8]=='manifest'):
			print(manifest)
			tmpManifestPath=os.path.join(tmpFamilyPath,manifest)	
			try:
				traverse(tmpManifestPath,1)
			except Exception as e:
				print(e)
print("",end="\n",file=count)
traverse(("/home/dell/AndroidMalwareAnalysis/benign/manifest"),2)#"/Users/dzih526/workspace/MalwareFeaturesCralwer/Benigh/manifest"
count.close()
