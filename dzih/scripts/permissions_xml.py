#!/usr/bin/python3
import json
import os
import numpy as np
import matplotlib.pyplot as plt
import xlwt
from openpyxl import Workbook
from openpyxl import load_workbook
from openpyxl.styles import PatternFill, Border, Side, Alignment, Protection, Font, Color, Fill
from openpyxl.styles import colors
from openpyxl.styles import Fill,fills
from openpyxl.formatting.rule import ColorScaleRule

permissions=[]
json_num=0
r=1
def get_all_permissions(path):
	global json_num
	jsons = os.listdir(path)
	for jsonf in jsons:
		jsonPath=os.path.join(path,jsonf)
		if (jsonf[-4:]=='json'):
			jsonName=jsonf[0:-5]
			json_num+=1
			with open(jsonPath,'r') as j:
				jsonObj = json.load(j)
				for per in jsonObj['permissions']:
					if per not in permissions:
						permissions.append(per)
def  output(path):
	global r
	ws=wb["Sheet1"]
	# ws.cell(row = 4, column = 2).value = 'test'
	jsons = os.listdir(path)
	for jsonf in jsons:
		jsonPath=os.path.join(path,jsonf)
		if (jsonf[-4:]=='json'):
			jsonName=jsonf[0:-5]
			r=r+1;
			ws.cell(row=r,column=1).value=jsonName		
			with open(jsonPath,'r') as j:
				jsonObj = json.load(j)
				for per in jsonObj['permissions']:						
					ws.cell(row=r,column=permissions.index(per)+2).value=1
	wb.save('data_benign.xlsx')

families = os.listdir('/home/dell/AndroidMalwareAnalysis/amd')
for family in families:
      tmpFamilyPath = os.path.join('/home/dell/AndroidMalwareAnalysis/amd',family)
      if (not os.path.isdir(tmpFamilyPath)):
          continue
      manifests=os.listdir(tmpFamilyPath)
      print(family)
      for manifest in manifests:
          if (manifest[0:8]=='manifest'):
              print(manifest)
              tmpManifestPath=os.path.join(tmpFamilyPath,manifest)
              get_all_permissions(tmpManifestPath)
wb=load_workbook('data_benign.xlsx')
ws=wb["Sheet1"]
for i in range(0,len(permissions)):
		ws.cell(row=1,column=i+2).value=permissions[i]

for family in families:
      tmpFamilyPath = os.path.join('/home/dell/AndroidMalwareAnalysis/amd',family)
      if (not os.path.isdir(tmpFamilyPath)):
          continue
      manifests=os.listdir(tmpFamilyPath)
      print(family)
      for manifest in manifests:
          if (manifest[0:8]=='manifest'):
              print(manifest)
              tmpManifestPath=os.path.join(tmpFamilyPath,manifest)
              output(tmpManifestPath)
wb.save('data_benign.xlsx')
#path="/home/dell/AndroidMalwareAnalysis/benign/manifest"
#get_all_permissions(path)
#output(path)

