m={}

#获得一个smali的api
def getApi(file):
	global m
	if file[-5:]!="smali":
		return
	f=open(file)
	lines=f.readlines()
	f.close()
	for line in lines:
		if line.find("invoke")!=-1:
			# print(line.split(",")[-1])
			s=line.split(",")[-1][:-1]
			if s not in m.keys():
				m[s]=1
			else:
				m[s]+=1



import os


def getSmali(apk_name):
	for path,d,files in os.walk(apk_name+"/smali"):
		for file in files:
			getApi(path+"/"+file)



def write():
	global m
	f=open("api_times.txt",'w')
	for key,value in m.items():
		f.write(str(key)+"\n"+str(value)+"\n")
	f.close()


dir1="data"
for path,dir,files in os.walk(dir1):
	# if d=="manifest":
	if path.find("variety")!=-1:
		for file in files:
			os.system('java -jar apktool.jar d '+path+'/'+file)
			getSmali(file[:-4])
			os.system('rm -r '+file[:-4])
write()

