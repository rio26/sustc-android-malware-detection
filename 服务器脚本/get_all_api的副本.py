malware_dir=""

import os
m={}
keyword=[]
count=0

#读取常用的lib，过滤掉外部的包的影响
def readLib():
	global keyword
	for path ,dir,files in os.walk("libraries"):
		for file in files:
			f=open(path+"/"+file)
			lines=f.readlines()
			f.close()
			for line in lines:
				keyword.append(line[:-1])

def deletePackageSmali(input_dir):
	for path,dir,files in os.walk(input_dir):
		if path.split("/")[-1]=="smali":
			for p,d,f in os.walk(path):
				#取出package name,判断是否包含在common lib里
					p_split=p.split("/")
					smali_idx=p_split.index('smali')
					p_split=p_split[smali_idx+1:]
					pkg=""
					for i in range(len(p_split)-1):
						pkg=pkg+p_split[i]+"."
					if pkg!="":
						pkg=pkg[:-1]
					if pkg in keyword:
						pkg=pkg.replace(".","/")
						print(path+"/"+pkg)
						os.system("rm -rf "+path+"/"+pkg)
						continue

def scanSmali():
	for family in os.listdir(d):
		if os.path.isdir(os.path.join(d,family)):
			for apk in os.listdir(os.path.join(d,family)):
				if os.path.isdir(os.path.join(d,family,apk)):
					malware.append(getInvokeNum(api,os.path.join(d,family,apk)))

	pass

#把common library 读进keyword数组
# readLib()
#把common library的smali文件夹删掉
# deletePackageSmali("origin")
##map<string,map<string,int>>来加快扫描速度


